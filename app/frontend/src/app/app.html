<div class="min-h-screen bg-slate-900 text-slate-100 flex flex-col">

  <!-- HEADER -->
  <header class="sticky top-0 z-50 border-b border-primary-500/30 bg-gradient-to-br from-slate-900/95 to-slate-800/95 backdrop-blur">
    <div class="max-w-7xl mx-auto px-4 py-4 space-y-4">

      <!-- Top Row -->
      <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-primary-500 to-secondary-500 flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                 class="text-white">
              <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
              <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
              <line x1="12" y1="22.08" x2="12" y2="12"></line>
            </svg>
          </div>

          <div>
            <h1 class="text-2xl font-bold bg-gradient-to-r from-primary-400 via-secondary-400 to-pink-400 bg-clip-text text-transparent">
              VisionForge ML Studio
            </h1>
            <p class="text-xs text-slate-400">Sistema de Predicción y Reentrenamiento</p>
          </div>
        </div>

        <!-- Actions globales -->
        <div class="flex items-center gap-2">
          <button
            (click)="state.toggleLogs()"
            class="inline-flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-medium
                   bg-slate-800/80 border border-slate-600/20 text-slate-200
                   hover:bg-slate-700/80 hover:border-slate-400/30 transition"
          >
            {{ state.showLogs ? 'Ocultar Logs' : 'Mostrar Logs' }}
          </button>

          <button
            (click)="state.onReloadModel()"
            class="inline-flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-medium
                   bg-gradient-to-br from-primary-500 to-primary-600 text-white
                   hover:brightness-110 transition active:translate-y-[1px]"
          >
            <span class="inline-block" [class.animate-spin]="state.reloadBusy">⟳</span>
            Recargar Modelo
          </button>
        </div>
      </div>

      <!-- Model Info (global) -->
      <div
        class="rounded-xl border border-primary-500/30 bg-slate-800/70 hover:border-primary-400/60
               hover:shadow-[0_0_20px_rgba(99,102,241,0.20)]
               transition cursor-pointer"
        (click)="state.modelExpanded = !state.modelExpanded"
      >
        <div class="p-4 flex flex-col md:flex-row md:items-center justify-between gap-4">
          <div class="text-slate-400 text-sm">Información del Modelo Activo</div>

          <div class="flex flex-wrap items-center gap-3">
            <div class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold
                        bg-primary-500/20 text-primary-200 border border-primary-500/30">
              DB: {{ state.activeInfo?.tracking_db || 'N/A' }}
            </div>

            <div class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold
                        bg-secondary-500/20 text-secondary-200 border border-secondary-500/30">
              Modelo: {{ state.activeInfo?.registered_model || 'N/A' }}
            </div>

            <div class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold
                        bg-primary-500/20 text-primary-200 border border-primary-500/30">
              Versión: {{
                state.activeInfo?.production_version !== undefined && state.activeInfo?.production_version !== null
                  ? state.activeInfo.production_version
                  : 'N/A'
              }}
            </div>

            <span class="text-slate-400 transition-transform duration-300 inline-block"
                  [style.transform]="state.modelExpanded ? 'rotate(180deg)' : 'rotate(0deg)'">
              ▾
            </span>
          </div>
        </div>

        <div
          class="overflow-hidden transition-[max-height] duration-300 bg-slate-950/60 border-t border-primary-500/20"
          [style.maxHeight]="state.modelExpanded ? '320px' : '0px'"
        >
          <pre class="m-0 p-4 text-xs text-primary-200/90 font-mono overflow-auto">{{ state.activeInfo | json }}</pre>
        </div>
      </div>

      <!-- NAV (prestación de servicios) -->
      <div class="rounded-2xl border border-slate-700/40 bg-slate-950/30 p-2 flex flex-wrap gap-2">
        <a
          routerLink="/"
          [routerLinkActiveOptions]="{ exact: true }"
          routerLinkActive="bg-primary-500/20 text-primary-200 border border-primary-500/40"
          class="px-4 py-2 rounded-xl text-sm text-slate-300 hover:bg-slate-800/40 transition"
        >
          Inicio
        </a>

        <a
          routerLink="/predict"
          routerLinkActive="bg-primary-500/20 text-primary-200 border border-primary-500/40"
          class="px-4 py-2 rounded-xl text-sm text-slate-300 hover:bg-slate-800/40 transition"
        >
          Predicción
        </a>

        <a
          routerLink="/annotate"
          routerLinkActive="bg-primary-500/20 text-primary-200 border border-primary-500/40"
          class="px-4 py-2 rounded-xl text-sm text-slate-300 hover:bg-slate-800/40 transition"
        >
          Anotación
        </a>

        <a
          routerLink="/retrain"
          routerLinkActive="bg-primary-500/20 text-primary-200 border border-primary-500/40"
          class="px-4 py-2 rounded-xl text-sm text-slate-300 hover:bg-slate-800/40 transition"
        >
          Reentrenar
        </a>
      </div>

    </div>
  </header>

  <!-- CONTENIDO (solo cambia por ruta) -->
  <main class="flex-1 container mx-auto px-4 py-6 pb-32">
    <div class="max-w-7xl mx-auto">
      <router-outlet></router-outlet>
    </div>
  </main>

  <!-- LOGS (fijo abajo) -->
  <div class="fixed bottom-0 left-0 right-0 border-t border-primary-500/20 bg-slate-950/90 backdrop-blur">
    <div class="max-w-7xl mx-auto px-4 py-3">
      <div class="flex items-center justify-between">
        <div class="text-sm text-slate-300 font-semibold">Logs</div>
        <button
          class="text-xs text-slate-400 hover:text-slate-200 transition"
          (click)="state.toggleLogs()"
        >
          {{ state.showLogs ? 'Ocultar' : 'Mostrar' }}
        </button>
      </div>

      <div *ngIf="state.showLogs" class="mt-3">
        <pre class="text-xs bg-slate-950 text-slate-100 p-3 rounded-xl overflow-auto max-h-56 border border-slate-800">{{ state.logs }}</pre>
      </div>
    </div>
  </div>

</div>
